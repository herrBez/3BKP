\documentclass{scrartcl}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xcolor}

\usepackage[utf8]{inputenc}
\usepackage[italian]{babel}

\usepackage{hyperref}

\newcommand{\MutliLineEquation}[3]{ 
	\ensuremath{
		#1 = \left\{
		\begin{array}{ll}
		1& \text{#2} \\
		0& \text{#3} \\
		\end{array}
		\right.
	}
}

\title{Estensione con più Zaini}
\begin{document}
\maketitle
\tableofcontents
\newpage
Lo scopo di questo documento è fornire un'estensione del modello esatto con più zaini introdotto in Baldi et al. \cite{Baldi20129802}.

\section{Descrizione generale del problema}

Siano dati:
\begin{itemize} 
	
	\item un insieme di parallelepipedi $K = \{1, \dots, m \}$ (gli \emph{zaini}) le loro dimensioni $W_k, H_k, D_k$ e il loro costo associato $f_k$ (modella quanto costa usare lo zaino $k$);
	\item un insieme di parallelepipedi $J = \{1, \dots, n\}$ (gli \emph{oggetti}) di profitto $p_j$ e dimensione $w_j, h_j, d_j$.
\end{itemize}

Si cercano $K' \subseteq K$ e $J' \subseteq J$ tali che gli oggetti in $J'$ siano contenuti nei limiti degli zaini $K'$ e il profitto sia massimo.


\textbf{N.B.: Non sono stati considerati i Balancing constraints del paper originale}.

\subsection{Modello}
\label{sec:original:model}
\begin{itemize}
	\item $J$ è l'insieme degli oggetti da inserire nello zaino di cardinalità $n$, cui sono associati gli indici $i$ e $j$;
	\item $K$ è l'insieme di possibili zaini, cui è associato l'indice $k$;
	\item $\Delta$ l'insieme delle dimensioni $\{0,1,2\}$ con l'indice associato $\delta$;
	\item $R$ è l'insieme delle possibili rotazioni degli oggetti, ha cardinalità $6$ e indice $r$;
	\item $s_{ir}^\delta$ dimensione dell'oggetto $i$--simo lungo la dimensione $\delta$ quando l'oggetto è rotato con la rotazione $r$;
	\item $S_{k}^\delta$ la dimensione del $k$--simo zaino nella dimensione $\delta$;
	\item $\chi_{ki}^\delta$ la coordinata del punto più in fondo, in basso a sinistra dell'oggetto $i$ lungo la dimensione $\delta$ nello zaino $k$ (il punto di coordinate minime);
	\item \MutliLineEquation{t_{ki}}{Se l'oggetto $i$ è contenuto nello zaino $k$}{Altrimenti}
	\item \MutliLineEquation{b_{kij}^\delta}{Se l'oggetto $i$ viene prima dell'oggetto $j$ lungo la dimensione $\delta$ nello zaino $k$}{Altrimenti}
	\item \MutliLineEquation{\rho_{ir}}{Se l'oggetto $i$ è rotato con la rotazione $r$}{Altrimenti}
	\item \MutliLineEquation{z_k}{Se lo zaino $k$--simo viene utilizzato}{Altrimenti}
	
\end{itemize}



\subsubsection{Funzione Obiettivo}
\begin{equation}
\text{ max }\left(\sum_{k \in K} \sum_{i \in J} p_i \cdot t_{ki}\right) - \left(\sum_{k \in K} f_k \cdot z_k\right)
\end{equation}


\subsubsection{Vincoli}
\begin{equation}
\label{eq:constraint:volume}
\sum_{j \in J} w_j d_j h_j t_{kj} \leq W_kD_kH_k \quad\quad \forall k \in K 
\end{equation}

\begin{equation}
\sum_{\delta\in\Delta}(b_{kij}^\delta + b_{kji}^\delta) \geq t_{ki} + t_{kj} - 1, \quad i < j,\ k \in K,\ i \in J,\ j \in J
\end{equation}
\begin{equation}
\label{eq:constraint:coodinateLessThanSkdelta}
\chi_{ki}^\delta + \sum_{r \in R} s_{ir}^\delta \rho_{ir} \leq S_k^\delta \quad \quad k \in K,\ i \in J,\ \delta \in \Delta
\end{equation}
\begin{equation}
\chi_{ki}^\delta + \sum_{r \in R} s_{ir}^\delta \rho_{ir} \leq \chi_{kj}^\delta + M(1 - b_{kij}^\delta), \quad \quad i < j,\ k \in K, i \in J, j \in J, \delta \in \Delta
\end{equation}
\begin{equation}
\chi_{kj}^\delta + \sum_{r \in R} s_{jr}^\delta \rho_{jr} \leq \chi_{ki}^\delta + M(1 - b_{kji}^\delta), \quad \quad i < j,\ k \in K, i \in J, j \in J, \delta \in \Delta
\end{equation}
\begin{equation}
\chi_{ki}^\delta \leq M t_{ki}\quad\quad k \in K, i \in J, \delta \in \Delta
\end{equation}
\begin{equation}
b_{kij}^\delta \leq t_{ki}\quad \quad k \in K, i \in J, j \in J, \delta \in \Delta
\end{equation}
\begin{equation}
b_{kji}^\delta \leq t_{kj} \quad \quad k \in K, i \in J, j \in J, \delta \in \Delta
\end{equation}
\begin{equation}
\sum_{r \in R} \rho_{ir} = \sum_{k \in K} t_{ki}\quad \quad i \in J
\end{equation}
\begin{equation}
\label{constraint:multi:tkzk}
t_{kj} \leq z_k\quad \quad k \in K, j \in J
\end{equation}
\begin{equation}
\label{constraint:multi:onlyInOneKnapsack}
\sum_{k \in K} t_{kj} \leq 1 \quad \quad j \in J
\end{equation}
\begin{equation}
\chi_{ki}^\delta \geq 0 \quad \quad k \in K, i \in J, \delta \in \Delta
\end{equation}
\begin{equation}
t_{ki} \in \{0,1\} \quad \quad k \in K, i \in J
\end{equation}
\begin{equation}
b_{kij}^\delta \in \{0,1\} \quad \quad k \in K, i \in J, j \in J, \delta \in \delta
\end{equation}
\begin{equation}
\rho_{ir} \in \{0,1\} \quad\quad i \in J, r \in R
\end{equation}
\begin{equation}
\label{zk:in:0:1}
z_k \in \{0,1\} \quad \quad k \in K
\end{equation}

\subsubsection{Note}
\begin{itemize}
\item Tutti i vincoli a parte \ref{constraint:multi:tkzk}, \ref{constraint:multi:onlyInOneKnapsack} e \ref{zk:in:0:1} sono stati ottenuti adattando i vincoli del modello di partenza.
\item Il vincolo \ref{constraint:multi:tkzk} fa sì che un oggetto possa essere inserito nel $k$--simo zaino soltanto se lo zaino viene effettivamente utilizzato nella soluzione.
\item Il vincolo \ref{constraint:multi:onlyInOneKnapsack} fa sì che un oggetto possa essere inserito al più in uno zaino. 
\item Il vincolo 9 è ridondante rispetto ad 8, infatti ogni vincolo di tipo 9 ha un corrispettivo di tipo 8.
\item Per il vincolo 7 si può utilizzare invece di un generico $M$, un parametro $E$ così definito:
$$
E = max(S_k^\delta : k \in K, \delta \in \Delta) + 1
$$ 
\end{itemize}

\section{Dimensioni del problema}
Assumendo verosimilmente che 
\begin{itemize}
	\item $|K| < |J|$
\end{itemize}  
dalla tabella \ref{table:no:variables}
si ottiene che il numero di variabili è minore di $3|J|^3 + 4|J|^2 + 7|J|$, quindi
nell'ordine di $O(|J|^3)$.



\begin{table}[h!]
	\center
	\begin{tabular}{|l|l|}
		\hline
		Variabili & \# Variabili \\
		\hline
		& \\
		$z_k$ & $|K|$ \\
		$\rho_{ir}$ & $|J| \cdot 6$\\
		$t_{ki}$ & $|J| \cdot |K|$ \\
		$\chi_{ki}^\delta$ & $|J| \cdot |K| \cdot | \Delta |$\\
		$b_{kij}^\delta$ & $|J| \cdot |J| \cdot |K| \cdot |\Delta|$\\ 
		& \\
		\hline
		& $3|J||J||K| + 4|J||K|+6|J|+K$ \\
		\hline
	\end{tabular}
	\caption{Numero di variabili del problema.}
	\label{table:no:variables}
\end{table}


Nella tabella \ref{table:no:constraints} sono riportati il numero di vincoli per ogni tipo di vincolo. 
Assumendo come per le variabili che $|K|$ sia minore di $|J|$ il numero di vincoli può essere sovrapprossimato nel modo seguente:
$$
\frac{19}{2}|J|^3 + \frac{15}{2}|J|^2 + 10|J|
$$
che è sempre nell'ordine $O(|J|^3)$.


\begin{table}[h!]
	\center
\begin{tabular}{|l|l|}
	\hline
	Vincoli & \# Vincoli\\
	\hline
	(2) & $|K|$ \\
	(3) & $|K| |J| (|J|-1)/2$ \\
	(4) & $3\cdot |K| |J| $ \\
	(5) & $3\cdot |K| |J| (|J|-1)/2$\\
	(6) & $3\cdot |K| |J| (|J|-1)/2$ \\
	(7) & $3\cdot |K| |J|$ \\
	(8) & $3\cdot |K| |J| |J|$\\
	(9) - È ridondante & 0 \\
	(10)& $|J|$ \\
	(11)& $|K| |J|$ \\
	(12)& $|J|$ \\
	\hline
	Totale    & $3\cdot|K||J||J| + 7\cdot|K||J|(|J|-1)/2 + 7|K||J|+ 2|J| + |K|$ \\
	(senza definizione dei domini) & \\
	\hline
	Dominio & \\
	\hline 
	(13)& $3 \cdot |K| |J|$ \\
	(14)& $|K| |J|$ \\
	(15)& $3 \cdot |K| |J| |J|$ \\
	(16)& $6 |J|$ \\
	(17)& $|K|$ \\
	\hline
	Totale & $6\cdot|K||J||J| + 7\cdot|K||J|(|J|-1)/2 + 11|K||J|+ 8|J| + 2|K|$ \\
	\hline
\end{tabular}
	\caption{Numero di vincoli per ogni tipo di vincolo.}
	\label{table:no:constraints}
\end{table}

\section{Balancing Constraints}
È stata anche considerata la possibilità di estendere i balancing constraint del paper originale:
\begin{equation}
\sum_{i \in J} m_i \chi_{i}^\delta + \sum_{i \in J}\sum_{r \in R} m_i \gamma_{ir}^\delta \rho_{ir} \geq L^\delta \sum_{i \in J} m_i t_i \quad\quad \delta \in \Delta
\end{equation}
\begin{equation}
\sum_{i \in J} m_i \chi_{i}^\delta + \sum_{i \in J}\sum_{r \in R} m_i \gamma_{ir}^\delta \rho_{ir} \leq U^\delta \sum_{i \in J} m_i t_i \quad\quad \delta \in \Delta
\end{equation}
dove 
\begin{itemize}
	\item $\gamma_{ir}^\delta$ è la coordinata del centro di massa dell'oggetto $i$ nella rotazione $r$ nella dimensione $\delta$.
	\item $L^\delta$ è il lower bound 
	\item $U^\delta$ è l'upper bound
\end{itemize}

per il modello con più zaini:
\begin{equation}
\sum_{i \in J} m_i \chi_{ki}^\delta + \sum_{i \in J}\sum_{r \in R} m_i \gamma_{ir}^\delta \rho_{ir} \geq L_k^\delta \sum_{i \in J} m_i t_{ki} \quad\quad k \in K, \delta \in \Delta
\end{equation}
\begin{equation}
\sum_{i \in J} m_i \chi_{ki}^\delta + \sum_{i \in J}\sum_{r \in R} m_i \gamma_{ir}^\delta \rho_{ir} \leq U_k^\delta \sum_{i \in J} m_i t_{ki} \quad\quad k \in K, \delta \in \Delta
\end{equation}

In questo caso vengono aggiunti $2 \cdot (|K| \cdot 3)$ vincoli a quelli del modello di partenza.

\section{Problema Accessorio}
Una volta risolto il problema, potrebbe essere desiderabile cercare di ridurre i valori delle coordinate
$\chi$ il più possibile.

Il modello rimane lo stesso ma cambia la funzione obiettivo
\begin{equation}
\text{ min. } \sum_{k\in k}\sum_{i \in J}\sum_{\delta \in \Delta'} \chi_{ki}^\delta
\end{equation}
dove $\Delta' \subseteq \Delta$.

Inoltre si fissano tutte le variabili $z_k, \rho_{ir}, t_{ki}$ e tutte le variabili $b_{kij}^\delta$ con $z_k = 0$.
Questo perché $b_{kij}^\delta$ definisce delle precedenze molto forti tra oggetti -- spesse volte non necessarie in alcune direzioni -- che potrebbero limitare l'ottimizzazione delle variabili $\chi$, per questo è stato preferito non fissarle.


\section{Problema Alternativo}

Un problema alternativo che è  stato analizzato è quello di considerare le dimensioni degli zaini delle variabili, con un upper bound fissato ($S_k^0, S_k^1, S_k^2$), in cui lo scopo è quello di trovare le dimensioni più piccole che contengano tutti gli zaini.

\subsection{Modello}
Il modello differisce di poco dal modello fornito nel capitolo \ref{sec:original:model}, vengono elencate le differenze:
\begin{itemize}
	\item $S_k^\delta$ definisce l'upper bound dello zaino $k$ lungo la dimensione $\delta$.
	\item $\sigma_k^\delta$ è l'estensione dello zaino $k$ lungo la dimensione $\delta$. È limitato superiormente dal valore $S_k^\delta$ fornito in input\footnote{Qualora si volesse trovare le dimensioni di uno zaino che racchiuda tutti gli oggetti $J$ è sufficiente
	mettere in input uno zaino solo e fissare gli upper bound a valori molto alti.}. 
\end{itemize}
\subsubsection{Funzione obiettivo}
Lo scopo è quello di minimizzare il volume degli zaini restando nei limiti $S_k^\delta$. Siccome il modello deve restare lineare non è possibile calcolare il volume, per questo motivo si utilizza come euristica del volume la somma delle lunghezze degli spigoli $\sigma_k^\delta$.
\begin{equation}
\text{ min. } \sum_{k \in K} \sum_{\delta \in \Delta} \sigma_k^\delta
\end{equation}

\subsubsection{Vincoli}
Siccome il volume degli oggetti ora non è più dato dalla moltiplicazione di parametri ma bensì di variabili, il vincolo
(\ref{eq:constraint:volume}) non può più essere considerato. Siccome è ridondante rispetto ai vincoli (\ref{eq:constraint:coodinateLessThanSkdelta}), che assumono ora la forma:

\begin{equation}
\label{eq:constraint:coodinateLessThanSigmakdelta}
\chi_{ki}^\delta + \sum_{r \in R} s_{ir}^\delta \rho_{ir} \leq \sigma_k^\delta \quad \quad k \in K,\ i \in J,\ \delta \in \Delta
\end{equation}
può non essere considerato\footnote{In Baldi et. al viene considerato per questioni numeriche.}.

Il vincolo numero \ref{constraint:multi:onlyInOneKnapsack} deve essere modificato in modo tale che \emph{tutti} gli oggetti siano inclusi nella soluzione:
\begin{equation}
\label{constraint:multi:onlyInExactlyOneKnapsack}
\sum_{k \in K} t_{kj} = 1 \quad \quad j \in J
\end{equation}
Inoltre come già accennato vanno aggiunti i bound per le variabili $\sigma_k^\delta$:
\begin{equation}
\sigma_k^\delta \in [ 0, S_k^\delta ]
\end{equation}

\section{Problema Accessorio}
Il problema accessorio è esattamente lo stesso di quello di capitolo \ref{} ma bisogna fissare anche le variabili $\sigma_k^\delta$.

\section{File di Input}
\begin{itemize}
	\item $K$, il numero di zaini
	\item Seguono $K$ righe contenente nella riga $k$ i dati per lo zaino $k$ intervallati da uno spazio:
	\begin{itemize}
		\item $S_k^0$
		\item $S_k^1$
		\item $S_k^2$
		\item $f_k$
	\end{itemize} 
	Se il problema è esteso (con i \emph{balancing constraints}) si aggiungono anche:
	\begin{itemize}
		\item $L_k^0$
		\item $L_k^1$
		\item $L_k^2$
		\item $U_k^0$
		\item $U_k^1$
		\item $U_k^2$
	\end{itemize}
	\item $N$, il numero di oggetti ($|J|$)
	\begin{itemize}
		\item $s_i^1$
		\item $s_i^2$
		\item $s_i^3$
		\item $m_i$
		\item $p_i$
	\end{itemize}
\end{itemize}

\section{Refusi nel paper originale}
Nello sviluppo di questo lavoro sono stati riscontrati alcuni refusi nel paper di Baldi et al. \cite{Baldi20129802}.
\begin{itemize}
	\item Nel vincolo $n^\circ 10$ c'è un errore di stampa:
	$$
	\chi_j^\delta + \sum_{r\in R} s_{jr}\rho_{ir} \leq \chi_i^\delta + M(1-b_{ji})
	$$
	dovrebbe essere 
	$$
	\chi_j^\delta + \sum_{r\in R} s_{jr}\rho_{\mathbf{\color{red}j}r} \leq \chi_i^\delta + M(1-b_{ji})
	$$
	Infatti sostituendo la prima equazione con la seconda, tutte le sovrapposizioni tra gli oggetti scompaiono.
	\item Il vincolo $n^\circ 8$ unito al vincolo $n^\circ 16$ fanno sì che qualora si inserisse in $J$ un oggetto che non ha abbastanza spazio all'interno dello zaino il modello sarà inammissibile. Per ovviare a questo problema si può modificare il vincolo $n^\circ 16$:
	$$
	\sum_{r \in R} \rho_{ir} = t_i
	$$
	Infatti l'oggetto deve avere una rotazione soltanto se viene effettivamente inserito nello zaino\footnote{ 
	Naturalmente un'altra soluzione potrebbe essere semplicemente di controllare che tutti gli oggetti siano più piccoli dello zaino.}.
	\item Il vincolo $n^\circ\ 12$ e $n^\circ\ 13$ sono ridondanti, infatti ogni vincolo in 12 ha un corrispettivo in 13. L'unica differenza è che vengono elencati in due maniere diverse.
\end{itemize}

\bibliographystyle{unsrt}

\bibliography{sources}

\end{document}
