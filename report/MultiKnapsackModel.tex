\documentclass{scrartcl}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xcolor}



\usepackage[utf8]{inputenc}
\usepackage[italian]{babel}
\usepackage{hyperref}



\newcommand{\MutliLineEquation}[3]{ 
	\ensuremath{
		#1 = \left\{
		\begin{array}{ll}
		1& \text{#2} \\
		0& \text{#3} \\
		\end{array}
		\right.
	}
}

\newtheorem{problem}{Problema}

\title{Possibili Estensioni del 3(B)KP}
\author{Mirko Bez \\
	mirko.bez@studenti.unipd.it
	}
\begin{document}

\allowdisplaybreaks


\maketitle
\tableofcontents
\newpage
\section{Introduzione}
Lo scopo di questo documento è proporre alcune possibili estensioni per il modello esatto definito in Baldi et al. \cite{Baldi20129802}, che d'ora in poi verrà riferito come \emph{paper originale}.

\begin{problem}[3KP]
Il problema consiste nel posizionare ortogonalmente un sottoinsieme di oggetti tridimensionali all'interno di uno zaino in modo tale da massimizzare il profitto totale degli oggetti caricati. 
Gli oggetti posizionati non devono avere sovrapposizioni e possono essere ruotati.
\end{problem}

\begin{problem}[3BKP]
	Estensione del 3KP in cui il centro di massa dello zaino deve risiedere all'interno di un'area specificata dello zaino (vincoli di bilanciamento).
\end{problem}

Nella Sezione \ref{sec:modello:originale} viene riportato il modello descritto nel paper originale~\cite{Baldi20129802} per rendere i riferimenti al modello
di partenza più immediati e quindi il documento più leggibile.

Nella Sezione \ref{sec:extension1} verrà analizzata un'estensione del 3KP con più zaini, cui viene associato un costo fisso differente per ciascuno zaino.

Nella Sezione \ref{sec:extension2} viene considerato un problema analogo, ma differente il cui scopo è quello di inserire tutti gli oggetti all'interno degli zaini e cercare di minimizzare le dimensioni e il numero degli stessi. 

 All'interno della Sezione \ref{sec:Balancing:Constraint} viene descritto come si potrebbero estendere i vincoli di bilanciamento per più zaini. 


Segue una sezione in cui si descrive come compilare il programma e i formati dei file di input e di output e per concludere verranno evidenziati alcuni refusi del paper originale riscontrati durante lo sviluppo di questo progetto.

\section{Modello Originale}
\label{sec:modello:originale}

Viene qui riportato il modello originale descritto in Baldi et al. \cite{Baldi20129802}.

Sia dato:
\begin{itemize} 
	\item uno zaino di dimensione $W, H, D$, anche riferite come $S^0, S^1, S^2$.
	\item un insieme di parallelepipedi $J = \{1, \dots, n\}$\ (gli \emph{oggetti}) di profitto $p_j$ e dimensione $w_j, h_j, d_j$.
\end{itemize}

Si cerca e $J' \subseteq J$ tale che gli oggetti in $J'$ siano contenuti nei limiti dello zaino.


\subsection{Modello}
\begin{itemize}
	\item $J$ è l'insieme degli oggetti -- di cardinalità $n$ -- cui sono associati gli indici $i$ e $j$;
	\item $\Delta$ l'insieme delle dimensioni $\{0,1,2\}$ con l'indice associato $\delta$;
	\item $R$ è l'insieme delle possibili rotazioni degli oggetti, ha cardinalità $6$ e indice $r$;
	\item $s_{ir}^\delta$ dimensione dell'oggetto $i$--simo lungo la dimensione $\delta$ quando l'oggetto è ruotato con la rotazione $r$;
	\item $S^\delta$ la dimensione dello zaino nella dimensione $\delta$;
	\item $\chi_{i}^\delta$ la coordinata del punto più in fondo, in basso a sinistra  (il punto di coordinate minime) dell'oggetto $i$ lungo la dimensione $\delta$ nello zaino;
	\item \MutliLineEquation{t_{i}}{Se l'oggetto $i$ è contenuto nello zaino}{Altrimenti}
	\item \MutliLineEquation{b_{ij}^\delta}{Se l'oggetto $i$ viene prima dell'oggetto $j$ lungo la dimensione $\delta$ nello zaino}{Altrimenti}
	\item \MutliLineEquation{\rho_{ir}}{Se l'oggetto $i$ è ruotato con la rotazione $r$}{Altrimenti}
\end{itemize}


\subsubsection{Funzione Obiettivo}
\begin{flalign}
\text{ max } \left(\sum_{i \in J} p_i \cdot t_{i}\right)
\end{flalign}

\subsubsection{Vincoli}
\begin{flalign}
\label{eq:constraint:volume}
\sum_{j \in J} w_j d_j h_j t_{j} \leq \prod_{\delta \in \Delta} S^\delta & \\
%
\sum_{\delta\in\Delta}(b_{ij}^\delta + b_{ji}^\delta) \geq t_{i} + t_{j} - 1 &&  i < j,\ i \in J,\ j \in J \\
%
\sum_{\delta\in\Delta}(b_{ij}^\delta + b_{ji}^\delta) \geq t_{i} + t_{j} - 1 && i < j,\ i \in J,\ j \in J \\
%
\label{eq:orig:constraint:coodinateLessThanSkdelta}
\chi_{i}^\delta + \sum_{r \in R} s_{ir}^\delta \rho_{ir} \leq S^\delta && i \in J,\ \delta \in \Delta \\
%
\chi_{i}^\delta + \sum_{r \in R} s_{ir}^\delta \rho_{ir} \leq \chi_{j}^\delta + M(1 - b_{ij}^\delta) &&  i < j,\ i \in J, j \in J, \delta \in \Delta \\
%
\chi_{j}^\delta + \sum_{r \in R} s_{jr}^\delta \rho_{jr} \leq \chi_{i}^\delta + M(1 - b_{ji}^\delta) && i < j,\ i \in J, j \in J, \delta \in \Delta \\
%
\chi_{i}^\delta \leq M t_{i} &&  i \in J, \delta \in \Delta \\
%
b_{ij}^\delta \leq t_{i} && i \in J, j \in J, \delta \in \Delta \\
%
b_{ji}^\delta \leq t_{j} && i \in J, j \in J, \delta \in \Delta \\
%
\label{eq:constraint:rho:ir:leq:sumk}
\sum_{r \in R} \rho_{ir} = 1 && i \in J \\
%
\chi_{i}^\delta \geq 0 && i \in J, \delta \in \Delta \\
%
t_{i} \in \{0,1\} && i \in J \\
%
b_{ij}^\delta \in \{0,1\} && i \in J, j \in J, \delta \in \Delta \\
%
\rho_{ir} \in \{0,1\} && i \in J, r \in R \\
\nonumber
\end{flalign}










\section{Estensione del 3KP con più zaini}
\label{sec:extension1}

Siano dati:
\begin{itemize} 
	
	\item un insieme di parallelepipedi $K = \{1, \dots, m \}$\ (gli \emph{zaini}) le loro dimensioni $W_k, H_k, D_k$ e il loro costo associato $f_k$ (modella quanto costa usare lo zaino $k$);
	\item un insieme di parallelepipedi $J = \{1, \dots, n\}$\ (gli \emph{oggetti}) di profitto $p_j$ e dimensione $w_j, h_j, d_j$.
\end{itemize}

Si cercano $K' \subseteq K$ e $J' \subseteq J$ tali che gli oggetti in $J'$ siano contenuti nei limiti degli zaini $K'$ e il profitto sia massimo.


\textbf{N.B.: Non sono stati considerati i Balancing constraints del paper originale}.

\subsection{Modello}
\label{sec:modello:multi3BKP}
\begin{itemize}
	\item $J$ è l'insieme degli oggetti -- di cardinalità $n$ -- cui sono associati gli indici $i$ e $j$;
	\item $K$ è l'insieme di possibili zaini, cui è associato l'indice $k$;
	\item $\Delta$ l'insieme delle dimensioni $\{0,1,2\}$ con l'indice associato $\delta$;
	\item $R$ è l'insieme delle possibili rotazioni degli oggetti, ha cardinalità $6$ e indice $r$;
	\item $s_{ir}^\delta$ dimensione dell'oggetto $i$--simo lungo la dimensione $\delta$ quando l'oggetto è ruotato con la rotazione $r$;
	\item $S_{k}^\delta$ la dimensione del $k$--simo zaino nella dimensione $\delta$;
	\item $\chi_{ki}^\delta$ la coordinata del punto più in fondo, in basso a sinistra  (il punto di coordinate minime) dell'oggetto $i$ lungo la dimensione $\delta$ nello zaino $k$;
	\item \MutliLineEquation{t_{ki}}{Se l'oggetto $i$ è contenuto nello zaino $k$}{Altrimenti}
	\item \MutliLineEquation{b_{kij}^\delta}{Se l'oggetto $i$ viene prima dell'oggetto $j$ lungo la dimensione $\delta$ nello zaino $k$}{Altrimenti}
	\item \MutliLineEquation{\rho_{ir}}{Se l'oggetto $i$ è ruotato con la rotazione $r$}{Altrimenti}
	\item \MutliLineEquation{z_k}{Se lo zaino $k$--simo viene utilizzato}{Altrimenti}
	
\end{itemize}



\subsubsection{Funzione Obiettivo}
\begin{equation}
\text{ max }\left(\sum_{k \in K} \sum_{i \in J} p_i \cdot t_{ki}\right) - \left(\sum_{k \in K} f_k \cdot z_k\right)
\end{equation}


\subsubsection{Vincoli}
\begin{flalign}
\label{eq:constraint:volume}
\sum_{j \in J} w_j d_j h_j t_{kj} \leq W_kD_kH_k && \forall k \in K \\
%
\sum_{\delta\in\Delta}(b_{kij}^\delta + b_{kji}^\delta) \geq t_{ki} + t_{kj} - 1 && i < j,\ k \in K,\ i \in J,\ j \in J \\
%
\label{eq:constraint:coodinateLessThanSkdelta}
\chi_{ki}^\delta + \sum_{r \in R} s_{ir}^\delta \rho_{ir} \leq S_k^\delta \cdot t_{ki} + M (1 - t_{ki}) && k \in K,\ i \in J,\ \delta \in \Delta \\
%
\chi_{ki}^\delta + \sum_{r \in R} s_{ir}^\delta \rho_{ir} \leq \chi_{kj}^\delta + M(1 - b_{kij}^\delta) && i < j,\ k \in K, i \in J, j \in J, \delta \in \Delta \\
%
\chi_{kj}^\delta + \sum_{r \in R} s_{jr}^\delta \rho_{jr} \leq \chi_{ki}^\delta + M(1 - b_{kji}^\delta) && i < j,\ k \in K, i \in J, j \in J, \delta \in \Delta \\
% 
\chi_{ki}^\delta \leq M t_{ki} && k \in K, i \in J, \delta \in \Delta \\
%
b_{kij}^\delta \leq t_{ki} && k \in K, i \in J, j \in J, \delta \in \Delta \\
%
b_{kji}^\delta \leq t_{kj} && k \in K, i \in J, j \in J, \delta \in \Delta \\
%
\label{eq:constraint:rho:ir:leq:sumk}
\sum_{r \in R} \rho_{ir} = \sum_{k \in K} t_{ki} && i \in J \\
%
\label{constraint:multi:tkzk}
t_{kj} \leq z_k && k \in K, j \in J \\
%
\label{constraint:multi:onlyInOneKnapsack}
\sum_{k \in K} t_{kj} \leq 1 && j \in J \\
%
\chi_{ki}^\delta \geq 0 && k \in K, i \in J, \delta \in \Delta \\ 
%
t_{ki} \in \{0,1\} && k \in K, i \in J \\
%
b_{kij}^\delta \in \{0,1\} && k \in K, i \in J, j \in J, \delta \in \Delta \\
%
\rho_{ir} \in \{0,1\} && i \in J, r \in R \\
%
\label{zk:in:0:1}
z_k \in \{0,1\} && k \in K \\
\nonumber
\end{flalign}

\subsubsection{Note}
\begin{itemize}
\item Tutti i vincoli a parte (\ref{constraint:multi:tkzk}), (\ref{constraint:multi:onlyInOneKnapsack}) e (\ref{zk:in:0:1}) sono stati ottenuti adattando i vincoli del modello di partenza.
\item Il vincolo (\ref{constraint:multi:tkzk}) fa sì che un oggetto possa essere inserito nel $k$--simo zaino soltanto se lo zaino viene effettivamente utilizzato nella soluzione.
\item Il vincolo (\ref{constraint:multi:onlyInOneKnapsack}) fa sì che un oggetto possa essere inserito al più in uno zaino. 
\item Il vincolo (9) è ridondante rispetto ad (8), infatti ogni vincolo di tipo (9) ha un corrispettivo di tipo (8).
\item Per il vincolo (7) si può utilizzare invece di un generico $M$, un parametro $E$ così definito:
$$
E = max(S_k^\delta : k \in K, \delta \in \Delta) + 1
$$ 
\end{itemize}

\subsection{Dimensioni del problema}
\label{sec:orig:dimensioneDelProblema}
Assumendo verosimilmente che 
\begin{itemize}
	\item $|K| < |J|$
\end{itemize}  
dalla Tabella \ref{table:no:variables}
si ottiene che il numero di variabili è minore di $3|J|^3 + 4|J|^2 + 7|J|$, quindi
nell'ordine di $O(|J|^3)$.



\begin{table}[h!]
	\center
	\begin{tabular}{|l|l|}
		\hline
		Variabili & \# Variabili \\
		\hline
		& \\
		$z_k$ & $|K|$ \\
		$\rho_{ir}$ & $|J| \cdot 6$\\
		$t_{ki}$ & $|J| \cdot |K|$ \\
		$\chi_{ki}^\delta$ & $|J| \cdot |K| \cdot | \Delta |$\\
		$b_{kij}^\delta$ & $|J| \cdot |J| \cdot |K| \cdot |\Delta|$\\ 
		& \\
		\hline
		& $3|J||J||K| + 4|J||K|+6|J|+ |K|$ \\
		\hline
	\end{tabular}
	\caption{Numero di variabili del problema.}
	\label{table:no:variables}
\end{table}


Nella Tabella \ref{table:no:constraints} sono riportati il numero di vincoli per ogni tipo di vincolo. 
Assumendo, come per le variabili che $|K|$ sia minore di $|J|$, il numero di vincoli può essere sovrapprossimato nel modo seguente:
$$
\frac{19}{2}|J|^3 + \frac{15}{2}|J|^2 + 10|J|
$$
che è sempre nell'ordine $O(|J|^3)$.


\begin{table}[h!]
	\center
\begin{tabular}{|l|l|}
	\hline
	Vincoli & \# Vincoli\\
	\hline
	(2) & $|K|$ \\
	(3) & $|K| |J| (|J|-1)/2$ \\
	(4) & $3\cdot |K| |J| $ \\
	(5) & $3\cdot |K| |J| (|J|-1)/2$\\
	(6) & $3\cdot |K| |J| (|J|-1)/2$ \\
	(7) & $3\cdot |K| |J|$ \\
	(8) & $3\cdot |K| |J| |J|$\\
	(9) - È ridondante & 0 \\
	(10)& $|J|$ \\
	(11)& $|K| |J|$ \\
	(12)& $|J|$ \\
	\hline
	Totale    & $3\cdot|K||J||J| + 7\cdot|K||J|(|J|-1)/2 + 7|K||J|+ 2|J| + |K|$ \\
	(senza definizione dei domini) & \\
	\hline
	Dominio & \\
	\hline 
	(13)& $3 \cdot |K| |J|$ \\
	(14)& $|K| |J|$ \\
	(15)& $3 \cdot |K| |J| |J|$ \\
	(16)& $6 |J|$ \\
	(17)& $|K|$ \\
	\hline
	Totale & $6\cdot|K||J||J| + 7\cdot|K||J|(|J|-1)/2 + 11|K||J|+ 8|J| + 2|K|$ \\
	\hline
\end{tabular}
	\caption{Numero di vincoli per ogni tipo di vincolo.}
	\label{table:no:constraints}
\end{table}

\subsection{Problema Accessorio}
\label{sec:orig:problemaAcessorio}
Una volta risolto il problema, potrebbe essere desiderabile cercare di ridurre i valori delle coordinate
$\chi$ il più possibile.

Il modello rimane lo stesso ma cambia la funzione obiettivo
\begin{equation}
\text{ min } \sum_{k\in k}\sum_{i \in J}\sum_{\delta \in \Delta'} \chi_{ki}^\delta
\end{equation}
dove $\Delta' \subseteq \Delta$ e $\Delta' \neq \varnothing$.

Inoltre si fissano tutte le variabili $z_k, \rho_{ir}, t_{ki}$ e tutte le variabili $b_{kij}^\delta$ con $z_k = 0$, ma non quelle con $z_k = 1$, perché $b_{kij}^\delta$ definisce delle precedenze molto forti tra oggetti -- molte volte non necessarie in alcune direzioni -- che potrebbero limitare l'ottimizzazione delle variabili $\chi$, per questo è stato preferito non fissarle.


\section{Problema alternativo}
\label{sec:extension2}
Un problema alternativo che è  stato analizzato è quello di considerare le dimensioni degli zaini come delle variabili, con un upper bound fissato ($S_k^0, S_k^1, S_k^2$), in cui lo scopo è quello di trovare le dimensioni minime che gli zaini devono avere, affinché possano contenere tutti gli oggetti.

\subsection{Modello}
Il modello differisce di poco dal modello fornito nella
Sezione \ref{sec:modello:Multi3BKP}, quindi vengono elencate soltanto le differenze:
\begin{itemize}
	\item $S_k^\delta$ definisce l'upper bound della lunghezza dello zaino $k$ lungo la dimensione $\delta$.
	
	\item $\sigma_k^\delta$ è una variabile che codifica l'estensione dello zaino $k$ lungo la dimensione $\delta$. È limitato superiormente dal valore $S_k^\delta$ fornito in input.
	Qualora si volesse trovare le dimensioni di un unico zaino che racchiuda tutti gli oggetti $J$ è sufficiente	mettere in input uno zaino solo e fissare gli upper bound a valori molto alti. 
	
	\item Al posto della variabile $\rho_{ir}$ qui viene definita una variabile che itera anche tra gli zaini: $\rho_{kir}$. 
	Se si mantiene la $\rho$ su due dimensioni e si utilizza il vincolo (\ref{eq:constraint:rho:ir:leq:sumk}) si creano dei vincoli che fanno sì che tutti gli oggetti debbano essere più piccoli di ogni zaino, come spiegato nella sezione \ref{sec:extension2:Note}.
\end{itemize}
\subsubsection{Funzione obiettivo}
Lo scopo è quello di minimizzare il volume degli zaini restando nei limiti $S_k^\delta$. Siccome il modello deve restare lineare non è possibile calcolare il volume degli zaini, per questo motivo si utilizza come euristica per il calcolo del volume la somma delle lunghezze degli spigoli $\sigma_k^\delta$:
\begin{equation}
\text{ min } \sum_{k \in K} \sum_{\delta \in \Delta} \sigma_k^\delta
\end{equation}
Siccome è desiderabile, a parità di somma delle dimensione dei vari zaini, diminuire il numero di zaini inclusi nella soluzione è stata preferita la seguente funzione obiettivo:
\begin{equation}
\text{ min } \sum_{k \in K} \sum_{\delta \in \Delta} \sigma_k^\delta + \sum_{k \in K} z_k
\end{equation}
\subsubsection{Vincoli}

\begin{flalign}
\sum_{\delta\in\Delta}(b_{kij}^\delta + b_{kji}^\delta) \geq t_{ki} + t_{kj} - 1 && i < j,\ k \in K,\ i \in J,\ j \in J \\
%
\label{eq:rho:kir:leq:sigmakdelta}
\chi_{ki}^\delta + \sum_{r \in R} s_{ir}^\delta \rho_{kir} \leq \sigma_k^\delta \cdot + M \ (1-t_{ki})  && k \in K,\ i \in J,\ \delta \in \Delta \\
%
\label{eq:rho:kir:leq:precedenceA}
\chi_{ki}^\delta + \sum_{r \in R} s_{ir}^\delta \rho_{kir} \leq \chi_{kj}^\delta + M(1 - b_{kij}^\delta) && i < j,\ k \in K, i \in J, j \in J, \delta \in \Delta \\
%
\label{eq:rho:kir:leq:precedenceB}
\chi_{kj}^\delta + \sum_{r \in R} s_{jr}^\delta \rho_{kjr} \leq \chi_{ki}^\delta + M(1 - b_{kji}^\delta) && i < j,\ k \in K, i \in J, j \in J, \delta \in \Delta \\
%
\chi_{ki}^\delta \leq M t_{ki} && k \in K, i \in J && \in \Delta \\
%
b_{kij}^\delta \leq t_{ki} && k \in K, i \in J, j \in J, \delta \in \Delta \\
%
b_{kji}^\delta \leq t_{kj} && k \in K, i \in J, j \in J, \delta \in \Delta \\
%
\label{eq:rho:kir:sumofallrotation:tki}
\sum_{r \in R} \rho_{kir} = t_{ki} && k \in K, i \in J \\
%
\label{2:constraint:multi:tkzk}
t_{kj} \leq z_k && k \in K, j \in J \\
%
\label{2:constraint:multi:onlyInOneKnapsack}
\sum_{k \in K} t_{kj} = 1 && j \in J \\
\nonumber
%
\label{sigma_kdelta:leq:Skdelta}
\sigma_k^\delta \leq S_k^\delta z_k && \forall k \in K, \forall \delta \in \Delta \\
%
\chi_{ki}^\delta \geq 0 && k \in K, i \in J, \delta \in \Delta \\
%
t_{ki} \in \{0,1\} && k \in K, i \in J \\
%
b_{kij}^\delta \in \{0,1\} && k \in K, i \in J, j \in J, \delta \in \delta \\
%
\rho_{kir} \in \{0,1\} && k \in K, i \in J, r \in R \\
%
\label{2:zk:in:0:1}
z_k \in \{0,1\} && k \in K \\
%
\label{sigma_kdelta:geq:0}
\sigma_k^\delta \geq 0 && k\in K, \delta \in \Delta \\
\nonumber
\end{flalign}


\subsubsection{Note}
\label{sec:extension2:Note}
Vengono qui elencate brevemente le differenze con il modello descritto nella 
Sezione \ref{sec:extension1} e spiegate le motivazioni delle modifiche.
\begin{itemize}
\item Avendo esteso $\rho$ su tre dimensioni tutti i vincoli ((\ref{eq:rho:kir:leq:sigmakdelta}), (\ref{eq:rho:kir:leq:precedenceA}), (\ref{eq:rho:kir:leq:precedenceB}), (\ref{eq:rho:kir:sumofallrotation:tki})) che coinvolgono questa variabile devono essere modificati tenendo in considerazione anche l'indice $k$.

\item Siccome il volume degli zaini in questo modello è dato dalla moltiplicazione di variabili, il vincolo
(\ref{eq:constraint:volume}) non può più essere considerato. 
Ma poiché è ridondante rispetto ai vincoli \ref{eq:constraint:coodinateLessThanSkdelta}
può essere tralasciato senza intaccare la validità del modello\footnote{Nel paper originale il vincolo (\ref{eq:constraint:volume}) viene considerato esclusivamente per questioni numeriche.}. Al posto del vincolo (\ref{eq:constraint:coodinateLessThanSkdelta}) viene ora considerato il vincolo (\ref{eq:rho:kir:leq:sigmakdelta}) che coinvolge la variabile $\sigma_k^\delta$ invece del parametro $S_k^\delta$.

\item Il vincolo numero (\ref{constraint:multi:onlyInOneKnapsack}) deve essere modificato in modo tale che \emph{tutti} gli oggetti siano contenuti in uno zaino nella soluzione, dando forma al vincolo (\ref{2:constraint:multi:onlyInOneKnapsack}).

\item Il vincolo (\ref{eq:constraint:rho:ir:leq:sumk}) è stato sostituito dal nuovo vincolo (\ref{eq:rho:kir:sumofallrotation:tki}). Qualora si tenesse il vincolo (\ref{eq:constraint:rho:ir:leq:sumk}) si otterrebbe che qualsiasi zaino  dovrebbe essere più grande di tutti i singoli oggetti, per via  del vincolo (\ref{2:constraint:multi:onlyInOneKnapsack}).

\item Inoltre, come già accennato, vanno aggiunti i bound per le variabili $\sigma_k^\delta$:
\begin{equation}
\sigma_k^\delta \in [ 0, S_k^\delta ]
\end{equation}
che vengono codificati nei due vincoli
(\ref{sigma_kdelta:leq:Skdelta}) e (\ref{sigma_kdelta:geq:0}).
\end{itemize}
\subsection{Dimensione del problema}

La dimensione viene qui definita come differenza rispetto a quella calcolata in \ref{sec:orig:dimensioneDelProblema}.

Siccome si aggiungono le variabili $\sigma_k^\delta$ e le variabili $\rho_{kir}$ al posto delle variabili $\rho_{ir}$ il numero di variabili aumenta di:
\begin{itemize}
	\item $|K|\cdot|\Delta|$ unità per $\sigma_k^\delta$
	
	\item $6(|K|-1)\cdot |J|$ per $\rho_{kir}$
\end{itemize} 

Portando ad un numero approssimato usando l'assunzione $|K| < |J|$:
$$
3|J|^3 + 10|J|^2 + 4|J| 
$$


I vincoli decrescono di $|K|$ perché rimuoviamo il vincolo (\ref{eq:constraint:volume}). E aumentano di $2 \cdot |K|\cdot|\Delta|$ per via della definizione dei domini delle variabili $\sigma_k^\delta$ (i vincoli (\ref{sigma_kdelta:leq:Skdelta}) e (\ref{sigma_kdelta:geq:0})) e di $(|K|-1) |J|$ per via dei vincoli (\ref{eq:rho:kir:sumofallrotation:tki}).

In totale
$$
\frac{19}{2} |J|^3 + \frac{21}{2} |J|^2 + 10|J|
$$


Visto che le differenze avvengono solo al livello di grado $1$ e $2$ la dimensione asintotica delle variabili e dei vincoli è la stessa, tuttavia il secondo problema richiede molto più tempo per essere risolto soprattutto al crescere di $K$ visto che deve determinare il valore di un numero di variabili sensibilmente maggiore.


\subsection{Problema Accessorio}

Il problema accessorio è esattamente lo stesso di quello di capitolo \ref{sec:orig:problemaAcessorio} ma bisogna fissare anche le variabili $\sigma_k^\delta$ e $\rho_{kir}$.



\section{Balancing Constraints}
\label{sec:Balancing:Constraint}
È stata anche considerata la possibilità di estendere i balancing constraint del paper originale:
\begin{equation}
\sum_{i \in J} m_i \chi_{i}^\delta + \sum_{i \in J}\sum_{r \in R} m_i \gamma_{ir}^\delta \rho_{ir} \geq L^\delta \sum_{i \in J} m_i t_i \quad\quad \delta \in \Delta
\end{equation}
\begin{equation}
\sum_{i \in J} m_i \chi_{i}^\delta + \sum_{i \in J}\sum_{r \in R} m_i \gamma_{ir}^\delta \rho_{ir} \leq U^\delta \sum_{i \in J} m_i t_i \quad\quad \delta \in \Delta
\end{equation}
dove 
\begin{itemize}
	\item $\gamma_{ir}^\delta$ è la coordinata del centro di massa dell'oggetto $i$ nella rotazione $r$ nella dimensione $\delta$.
	\item $L^\delta$ è il lower bound 
	\item $U^\delta$ è l'upper bound
\end{itemize}

per il modello con più zaini:
\begin{equation}
\sum_{i \in J} m_i \chi_{ki}^\delta + \sum_{i \in J}\sum_{r \in R} m_i \gamma_{ir}^\delta \rho_{ir} \geq L_k^\delta \sum_{i \in J} m_i t_{ki} \quad\quad k \in K, \delta \in \Delta
\end{equation}
\begin{equation}
\sum_{i \in J} m_i \chi_{ki}^\delta + \sum_{i \in J}\sum_{r \in R} m_i \gamma_{ir}^\delta \rho_{ir} \leq U_k^\delta \sum_{i \in J} m_i t_{ki} \quad\quad k \in K, \delta \in \Delta
\end{equation}

In questo caso vengono aggiunti $2 \cdot (|K| \cdot 3)$ vincoli a quelli del modello di partenza.




\section{Come eseguire il programma}
\subsection{Compilazione}
La cartella \verb|Multi3BKP| contiene l'implementazione del primo modello, mentre \verb|Hull3BKP| contiene l'implementazione del problema alternativo.
Per compilare è sufficiente utilizzare il \verb|Makefile| contenuto nella rispettiva cartella.


\subsection{File di Input}
Per comodità entrambi i programmi utilizzano lo stesso file di input, anche se non tutti i parametri vengono utilizzati in tutti e due i programmi.
\begin{itemize}
	\item $K$, il numero di zaini
	\item Seguono $K$ righe contenente nella riga $k$ i dati per lo zaino $k$ intervallati da uno spazio:
	\begin{itemize}
		\item $S_k^0$
		\item $S_k^1$
		\item $S_k^2$
		\item $f_k$
	\end{itemize} 
	Se il problema è esteso (con i \emph{balancing constraints}) si aggiungono anche:
	\begin{itemize}
		\item $L_k^0$
		\item $L_k^1$
		\item $L_k^2$
		\item $U_k^0$
		\item $U_k^1$
		\item $U_k^2$
	\end{itemize}
	\item $N$, il numero di oggetti ($|J|$)
	\begin{itemize}
		\item $s_i^1$
		\item $s_i^2$
		\item $s_i^3$
		\item $m_i$
		\item $p_i$
	\end{itemize}
\end{itemize}

\subsection{File di output}
In questa sezione siano $K' \subseteq K$ l'insieme di zaini selezionati, 
$J^k$ gli oggetti che sono stati inseriti nel $k$--simo zaino e sia $r'$ la rotazione selezionata per l'oggetto $i$.


Il programma genera un file di output così costituito:
\begin{itemize}
	\item Una serie di righe di commento che includono anche il valore ottimo trovato
	\item $|K'|$ blocchi così formati:
		\begin{itemize}
			\item \verb|# Knapsack k-mo|
			\item $S_k^\delta$ o $\sigma_k^\delta$ a seconda se il programma è stato generato con \verb|main| o \verb|main_hull|
			\item Seguono $|J^k|$ righe contenenti le seguenti informazioni sugli oggetti inseriti nello zaino $k$:
			\begin{itemize}
				\item $i$, l'indice dell'oggetto
				\item $\chi_{ki}^0$
				\item $\chi_{ki}^1$
				\item $\chi_{ki}^2$
				\item $s_{ir'}^0$
				\item $s_{ir'}^1$
				\item $s_{ir'}^2$
			\end{itemize}
		\end{itemize}
\end{itemize}






\subsection{Visualizzazione}
Per visualizzare il file di output ed agevolare le fasi di verifica e validazione del modello è stato implementato un programma che rappresenta gli zaini e gli oggetti selezionati nello spazio, utilizzando la libreria grafica \verb|webgl|\footnote{\url{https://www.khronos.org/webgl/}}.

\subsection{Documentazione}
La documentazione del codice può essere generata utilizzando il programma \verb|doxygen|\footnote{\url{https://github.com/doxygen/doxygen}} all'interno delle rispettive cartelle.


\section{Refusi nel paper originale}
Nello sviluppo di questo lavoro sono stati riscontrati alcuni refusi nel paper di Baldi et al. \cite{Baldi20129802}.
\begin{itemize}
	\item Nel vincolo (10) di \cite{Baldi20129802} c'è un errore di stampa che causa in alcune istanze del problema
	la sovrapposizione di oggetti all'interno dello zaino:
	$$
	\chi_j^\delta + \sum_{r\in R} s_{jr}\rho_{ir} \leq \chi_i^\delta + M(1-b_{ji})
	$$
	dovrebbe essere 
	$$
	\chi_j^\delta + \sum_{r\in R} s_{jr}\rho_{\mathbf{\color{red}j}r} \leq \chi_i^\delta + M(1-b_{ji})
	$$
	Infatti sostituendo la prima equazione con la seconda, tutte le sovrapposizioni tra gli oggetti scompaiono.
	
	\item Il vincolo (8) unito al vincolo (16) di \cite{Baldi20129802}, fanno sì che, qualora si inserisca nell'insieme $J$ un oggetto che non abbia abbastanza spazio all'interno dello zaino, il modello sia inammissibile. Per ovviare a questo problema si può modificare il vincolo (16) di \cite{Baldi20129802} nel modo seguente:
	$$
	\sum_{r \in R} \rho_{ir} = \color{red}\mathbf{t_i}
	$$
	
	
	Infatti l'oggetto deve avere una rotazione soltanto se viene effettivamente inserito nello zaino.
	Una soluzione alternativa a questo problema potrebbe consistere nel controllare che tutti gli oggetti siano più piccoli dello zaino, prima di istanziare il modello.
	La prima soluzione è stata preferita alla seconda perché si prestava meglio alle estensioni mostrate in questo documento.
	\item Il vincolo (12) e (13) di \cite{Baldi20129802} sono ridondanti, infatti ogni vincolo in (12) ha un corrispettivo in (13). L'unica differenza è che i vincoli vengono elencati in due maniere diverse. 
\end{itemize}


\section{Performance}
Per testare le performance del modello proposto in Baldi et. al~\cite{Baldi20129802} e le estensioni fornite
in questo documento sono state generate varie istanze casuali.
Per motivi di tempo non sono stati considerati i Balancing Constraints. 

Con uno script python \path{instance_generator.py} sono state create varie istanze casuali cinque per ogni 
combinazione di $k = \{1,5,10,15\}$ e $j = \{10,20,30,40\}$. 

Il computer usato per le simulazioni ha 8GB di RAM (DDR3) un processore Intel(R) Core(TM) i7-3610QM CPU @ 2.30GHz del 2012~\cite{cpu}.

Per permettere delle analisi agevoli con \verb|R| è stata aggiunta un'opzione di --benchmark all'interno dei vari programmi. 
Questa opzione formatta l'output per contenere in una riga le seguenti informazioni: User Time, CPU Time, Objective Value, Timeout Reached (Yes/No).

Per rendere automatica l'esecuzione dei vari programmi è stato scritto uno script in bash \path{benchmark.sh}. 
All'inizio del file possono essere specificati i seguenti parametri:
\begin{itemize}
\item il programma da usare, 
\item il numero di esecuzioni per istanza, in questo documento sono stati usati 5 test per motivi di tempo,
\item la cartella dove trovare le istanze, 
\item una regex per i file da eseguire  (per esempio \verb|10*.dat| per eseguire tutti i file che cominciano con 10), 
\item secondi di pausa dopo l'esecuzione di un programma (utile per non fare surriscaldare il computer).
\item suffisso da dare ai file \verb|.csv| generati dal programma
\item timeout. Qui è stato usato come timeout 6300 secondi di cpu. Questo valore è stato ottenuto moltiplicando 15 minuti per 7, che sembrava essere
circa il parallelismo che riusciva a raggiungere CPLEX nei primi file.
\end{itemize}

I risultati dei benchmark grezzi possono essere trovati nella cartella \path{Benchmark}. Qui vengono riportati delle elaborazioni.
Purtroppo per le istanze in cui si è raggiunto il timeout non si hanno dati sulla soluzione ottima e quindi non si possono 
fare stima sul livello di accuratezza delle soluzioni incombenti. Sarebbe interessante misurare la distanza tra la soluzione ottima
e quelle incombenti, ma per motivi di tempo non sono riuscito a calcolarle. Viene quindi solo riportata la standard deviation dei valori
delle soluzioni.



\subsection{15 Zaini}

\begin{table}[h!]
\begin{center}
\small
\begin{tabular}{| c | c | c | c | c | c | c | c | c | c |}
\hline
inst. & done & AUT & CU & ACT & max & min & CV-T & ObjV & CV-O \\
\hline
\verb|10_1| & 5 / 5 & 0.0274 & 3.3608 & 0.0922 & 0.0989 & 0.0884 & 4.3444 & 1370.00 & 0.00\\ 
\verb|10_2| & 5 / 5 & 0.0103 & 2.4119 & 0.0247 & 0.0290 & 0.0225 & 10.3083 & 1668.00 & 0.00\\ 
\verb|10_3| & 5 / 5 & 0.0196 & 3.7409 & 0.0735 & 0.0759 & 0.0705 & 2.6602 & 1104.00 & 0.00\\ 
\verb|10_4| & 5 / 5 & 0.1513 & 5.4620 & 0.8264 & 0.8308 & 0.8216 & 0.4606 & 1226.00 & 0.00\\ 
\verb|10_5| & 5 / 5 & 0.0177 & 3.2744 & 0.0581 & 0.0606 & 0.0549 & 4.3044 & 1512.00 & 0.00\\ 
\verb|20_1| & 0 / 5 & 16.0912 & 6.9548 & 111.9108 & 121.0174 & 105.8202 & 7.4255 & 2454.00 & 0.00\\ 
\verb|20_2| & 0 / 5 & 16.5143 & 6.3963 & 105.6305 & 105.6581 & 105.6203 & 0.0149 & 2144.00 & 0.00\\ 
\verb|20_3| & 0 / 5 & 15.0028 & 7.0641 & 105.9810 & 106.1126 & 105.9059 & 0.0773 & 3001.00 & 0.00\\ 
\verb|20_4| & 0 / 5 & 15.1309 & 7.0066 & 106.0155 & 106.0362 & 105.9940 & 0.0158 & 1469.00 & 0.00\\ 
\verb|20_5| & 0 / 5 & 15.3664 & 6.8822 & 105.7544 & 105.7779 & 105.7350 & 0.0177 & 1606.00 & 0.00\\ 
\verb|30_1| & 0 / 5 & 16.6060 & 6.6281 & 110.0666 & 117.1187 & 105.3622 & 5.8486 & 2174.80 & 0.33\\ 
\verb|30_2| & 0 / 5 & 17.2941 & 6.1007 & 105.5053 & 105.5180 & 105.4947 & 0.0085 & 2667.60 & 2.55\\ 
\verb|30_3| & 0 / 5 & 16.6564 & 6.3292 & 105.4216 & 105.4249 & 105.4193 & 0.0022 & 2264.00 & 0.00\\ 
\verb|30_4| & 0 / 5 & 17.8652 & 6.5670 & 117.3200 & 117.3902 & 117.2509 & 0.0443 & 2265.00 & 0.00\\ 
\verb|30_5| & 0 / 5 & 20.0436 & 5.8523 & 117.3005 & 117.3528 & 117.2390 & 0.0377 & 2806.20 & 0.84\\ 
\verb|40_1| & 0 / 5 & 22.4948 & 5.2039 & 117.0611 & 117.0770 & 117.0522 & 0.0086 & 3339.00 & 2.48\\ 
\verb|40_2| & 0 / 5 & 21.0422 & 5.5732 & 117.2715 & 117.2845 & 117.2535 & 0.0099 & 3461.20 & 0.47\\ 
\verb|40_3| & 0 / 5 & 22.5891 & 5.1755 & 116.9096 & 116.9824 & 116.8894 & 0.0348 & 2706.80 & 0.48\\ 
\verb|40_4| & 0 / 5 & 20.2110 & 5.7857 & 116.9348 & 117.0042 & 116.9164 & 0.0332 & 3736.00 & 0.00\\ 
\verb|40_5| & 0 / 5 & 19.9309 & 5.8681 & 116.9571 & 117.0181 & 116.9200 & 0.0392 & 2994.00 & 0.00\\ 
\hline
\end{tabular}
\caption{$K = 15$ --- Multi3BKP}
\label{table:multi:15}
\end{center}
\end{table}





\bibliographystyle{unsrt}
\bibliography{sources}

\end{document}
